<div class="ui container">
    <div class="ui form">
        <form action="" method="post">
            {% csrf_token %}
            <div class="ui buttons">
                <input class="ui blue button" type='button' id='show_data' value="数据展示"/>
            </div>
        </form>
        <div class="ui divider"></div>
        <div action="" method="post">
            <!-- 在Django所有的 POST 表单元素时，需要加上下方的csrf_token tag，主要是安全方面的机制，本例后续使用AJAX方法，这里的POST class和token都不生效 -->
            {% csrf_token %}
            <h3 class="ui header" id="analysis">分析维度</h3>
            <div class="field">
                <div class="fields"></div>
                <div class="fields">
                    <div class="eight wide field">
                        <select name="Feature1" id="Feature1" class="ui fluid search dropdown">
                            {% for key, value in mselect_dict.items %}
                                {% if value.select == 'slidersn' %}
                                    <option value="{{ value.select }}" selected>{{ key }}</option>
                                {% else %}
                                    <option value="{{ value.select }}">{{ key }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <div class="field">
                <div class="fields"></div>
                <div class="fields">
                    <div class="eight wide field">
                            <select name="Feature2" id="Feature2" class="ui fluid search dropdown">
                                {% for key, value in mselect_dict.items %}
                                    {% if value.select == 'pACC' %}
                                        <option value="{{ value.select }}" selected>{{ key }}</option>
                                    {% else %}
                                        <option value="{{ value.select }}">{{ key }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <h3 class="ui header" id="asistance">辅助维度</h3>
            <div class="field">
                <div class="fields"></div>
                <div class="fields">
                    <div class="fifteen wide field">
                        <select name="Feature_opt" id="Feature_opt" class="ui fluid multiple search dropdown">
                            <!-- 默认hidden显示为Feature Selection -->
                            <option value="">Feature Selection</option>
                            {% for key, value in mselect_dict.items %}
                                <!-- <option value="{{ value.select }}" selected>{{ key }}</option> -->
                                <option value="{{ value.select }}">{{ key }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <div class="ui buttons">
                <input class="ui blue button" type='button' id='AJAX_get' value="选择"/>
            </div>
        </form>
    </div>
</div>
<script type="text/javascript">
    $("#show_data").click(function (event){
        event.preventDefault();
        $.ajax({
            url: '{% url 'visual:showdata' %}',
            type: 'GET',
            success: function(ret) {
                $("#alldata").html(ret['alldata'])
            },
            error: function() {
                console.log('failure')
            }
        });
    })
</script>
<script type="text/javascript">
    $("#AJAX_get").click(function (event) {
        event.preventDefault();
        var chart = echarts.init(document.getElementById('bar_total_trend'), 'white', {renderer: 'canvas'});
        chart.showLoading({
          text : '正在加载数据'
        });
        var form_data = {
            "Feature1": $("#Feature1").val(),
            "Feature2": $("#Feature2").val(),
            "Feature_opt": $("#Feature_opt").val(),
        };
        $.ajax({
            url: '{% url 'visual:query' %}',
            type: 'GET',
            data: form_data,
            success: function(ret) {
                if (ret["df_mean"] == 'N/A'){
                    alert('Warning! Selected feature is not numeric!');
                }
                $("#data_").html(ret['data_'])
                $("#df_mean").html(ret["df_mean"]);
                $("#df_std").html(ret["df_std"]);
                $("#df_median").html(ret["df_median"]);
                $("#data").html(ret['data']);
                chart.clear();
                chart.setOption(ret['scatter_pic']);
                chart.hideLoading()
            },
            error: function() {
                console.log('failure')
            }
        });
    })
</script>


<!-- 因为用到Semantic UI的Search Dropdown控件，必须有下面语句初始化 -->
<script>
    $('.ui.fluid.search.dropdown')
        .dropdown({ fullTextSearch: true });
</script>
